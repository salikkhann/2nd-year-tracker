<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2nd Year MBBS Tracker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
        }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Playfair+Display:ital,wght@0,400;0,700;1,400&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .serif { font-family: 'Playfair Display', serif; }
        
        /* Chart Container Styling */
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 400px;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 350px;
            }
        }

        /* Checkbox Styling */
        .checklist-item.checked { 
            background-color: rgba(241, 245, 249, 0.5); 
        }
        .dark .checklist-item.checked {
            background-color: rgba(30, 41, 59, 0.5);
        }

        /* Strikethrough Logic */
        .checklist-item.checked p { 
            text-decoration: line-through; 
            text-decoration-thickness: 2px;
            opacity: 0.6;
            color: #9ca3af; 
        }
        .dark .checklist-item.checked p {
            color: #64748b;
        }
        
        .checklist-item.checked .check-circle { background-color: #10b981; border-color: #10b981; }
        .checklist-item.checked .viva-badge { opacity: 0.5; }
        
        /* Personal Tracker Styles */
        .personal-tracker-card {
            transition: all 0.2s;
        }
        .personal-tracker-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
        
        .dark ::-webkit-scrollbar-thumb { background: #475569; }
        .dark ::-webkit-scrollbar-thumb:hover { background: #64748b; }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 dark:bg-slate-950 dark:text-slate-200 transition-colors duration-300">

    <!-- Navbar -->
    <nav class="bg-white dark:bg-slate-900 border-b border-slate-200 dark:border-slate-800 sticky top-0 z-50 shadow-sm transition-colors duration-300">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-20 items-center">
                <div class="flex items-center gap-4">
                    <div class="bg-blue-600 text-white p-2.5 rounded-lg hidden sm:block shadow-lg shadow-blue-500/30">
                        <i class="fa-solid fa-stethoscope text-2xl"></i>
                    </div>
                    <div>
                        <h1 class="font-extrabold text-xl sm:text-2xl text-slate-900 dark:text-white tracking-tight leading-none" id="student-name-display">Welcome, Medical Student</h1>
                        <p class="text-xs sm:text-sm text-slate-500 dark:text-slate-400 font-medium mt-0.5">2nd Year MBBS • Dow Exam Preparation</p>
                    </div>
                </div>
                <div class="flex items-center gap-4">
                    <!-- Edit Profile Button -->
                    <button onclick="editProfile()" class="text-xs font-semibold text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300 underline">
                        Edit Profile
                    </button>

                    <!-- Dark Mode Toggle -->
                    <button onclick="toggleDarkMode()" class="p-2 rounded-full text-slate-500 hover:bg-slate-100 dark:text-slate-400 dark:hover:bg-slate-800 transition-colors focus:outline-none">
                        <i id="theme-icon" class="fa-solid fa-moon text-lg"></i>
                    </button>

                    <div class="text-right hidden md:block border-l border-slate-200 dark:border-slate-700 pl-4 ml-2">
                        <div class="text-[10px] font-bold uppercase text-slate-400 dark:text-slate-500 tracking-wider">Mastery</div>
                        <div class="text-xl font-black text-emerald-600 dark:text-emerald-500 leading-none" id="global-progress">0%</div>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 space-y-8">

        <!-- Setup Modal (Hidden by default, shown if no data) -->
        <div id="setup-modal" class="fixed inset-0 bg-black/80 z-[100] hidden flex items-center justify-center backdrop-blur-sm">
            <div class="bg-white dark:bg-slate-900 rounded-xl shadow-2xl p-8 max-w-md w-full mx-4 border border-slate-200 dark:border-slate-700">
                <div class="text-center mb-6">
                    <div class="w-16 h-16 bg-blue-100 dark:bg-blue-900/30 rounded-full flex items-center justify-center mx-auto mb-4 text-blue-600 dark:text-blue-400">
                        <i class="fa-solid fa-user-doctor text-3xl"></i>
                    </div>
                    <h2 class="text-2xl font-bold text-slate-900 dark:text-white">Setup Your Tracker</h2>
                    <p class="text-slate-500 dark:text-slate-400 text-sm mt-2">Enter your details to customize your exam schedule.</p>
                </div>
                
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">Your Name</label>
                        <input type="text" id="input-name" class="w-full px-4 py-2 rounded-lg border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-800 text-slate-900 dark:text-white focus:ring-2 focus:ring-blue-500 outline-none" placeholder="e.g. Dr. Ali">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">Roll Number (1-360)</label>
                        <input type="number" id="input-roll" class="w-full px-4 py-2 rounded-lg border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-800 text-slate-900 dark:text-white focus:ring-2 focus:ring-blue-500 outline-none" placeholder="e.g. 145">
                        <p class="text-xs text-slate-500 mt-1">Used to calculate your specific OSPE/VIVA dates.</p>
                    </div>
                    <button onclick="saveProfile()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-lg transition-all transform hover:scale-[1.02]">
                        Start Tracking
                    </button>
                </div>
            </div>
        </div>

        <!-- Professional Motivation Section -->
        <section class="bg-gradient-to-br from-slate-900 to-slate-800 rounded-2xl shadow-xl overflow-hidden relative group border border-slate-700">
            <!-- Background Elements -->
            <div class="absolute top-0 right-0 w-64 h-64 bg-white/5 rounded-full blur-3xl -translate-y-1/2 translate-x-1/2"></div>
            <div class="absolute bottom-0 left-0 w-48 h-48 bg-blue-500/10 rounded-full blur-2xl translate-y-1/2 -translate-x-1/2"></div>
            
            <div class="relative z-10 p-10 md:p-14 flex flex-col items-center text-center justify-center min-h-[220px]">
                <h2 class="text-2xl md:text-3xl lg:text-4xl font-medium text-slate-100 mb-4 leading-relaxed max-w-4xl drop-shadow-md serif italic text-center">
                    "And whoever saves one life, it is as if he has saved mankind entirely."
                </h2>
                <p class="text-sm font-bold tracking-widest text-blue-400 uppercase opacity-90 mt-2 mb-6">— Quran 5:32</p>
                <p class="text-slate-300 text-sm md:text-base max-w-2xl leading-relaxed text-center opacity-80">
                    You have to do this. Even if you don't like it right now, one day this knowledge might be the tool you use to save a life.
                </p>
            </div>
        </section>

        <!-- Personal Tracker Dashboard -->
        <section class="space-y-4">
            <div class="flex justify-between items-end border-b border-slate-200 dark:border-slate-800 pb-2">
                <h2 class="text-lg font-bold text-slate-800 dark:text-slate-100 flex items-center gap-2">
                    <i class="fa-solid fa-chart-pie text-blue-600"></i> Module Status
                </h2>
                <button onclick="resetPersonalTracker()" class="text-xs font-semibold text-rose-500 hover:text-rose-700 dark:hover:text-rose-400 hover:underline transition-colors">
                    Reset Data
                </button>
            </div>
            
            <!-- Auto-fit grid for better responsiveness, handling 7 items neatly -->
            <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4" id="personal-tracker-grid">
                <!-- Cards injected via JS -->
            </div>
        </section>

        <!-- Section 1: Strategic Dashboard -->
        <section class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- Countdown Card -->
            <div class="bg-white dark:bg-slate-900 rounded-xl shadow-sm p-6 border border-slate-100 dark:border-slate-800 flex flex-col justify-center">
                <div class="flex justify-between items-center mb-4 border-b border-slate-100 dark:border-slate-800 pb-2">
                    <h2 class="text-lg font-bold text-slate-800 dark:text-slate-100">Exam Schedule</h2>
                    <div class="mt-4 text-sm text-slate-600 dark:text-slate-400 bg-slate-50 dark:bg-slate-800 p-2 rounded border border-slate-200 dark:border-slate-700 flex items-center gap-2">
                        <span class="font-semibold uppercase text-[10px]">Your Group:</span>
                        <span class="font-bold text-blue-700 dark:text-blue-400 text-xs" id="student-group-display">--</span>
                    </div>
                </div>
                
                <!-- Exam Grid -->
                <div id="exam-grid" class="grid grid-cols-2 sm:grid-cols-3 gap-3 text-center">
                    <!-- Cards injected via JS -->
                </div>
            </div>

            <!-- Visualization: Total Exam Prep -->
            <div class="bg-white dark:bg-slate-900 rounded-xl shadow-sm p-6 border border-slate-100 dark:border-slate-800">
                <div class="flex justify-between items-start mb-2">
                    <h2 class="text-lg font-bold text-slate-800 dark:text-slate-100">Total Syllabus Coverage</h2>
                    <span class="text-xs bg-emerald-100 text-emerald-700 dark:bg-emerald-900 dark:text-emerald-300 font-bold px-2 py-1 rounded">LIVE</span>
                </div>
                <p class="text-xs text-slate-500 dark:text-slate-400 mb-4">Completion of 2nd Year Science Modules (Excludes Gen Ed).</p>
                <div class="chart-container">
                    <canvas id="prepChart"></canvas>
                </div>
            </div>
        </section>

        <!-- Section 3: Master Tracker -->
        <section id="checklist-section" class="bg-white dark:bg-slate-900 rounded-xl shadow-sm border border-slate-100 dark:border-slate-800">
            <div class="px-6 py-6 border-b border-slate-200 dark:border-slate-800 flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                <div>
                    <h2 class="text-xl font-bold text-slate-800 dark:text-slate-100 flex items-center gap-2">
                        <i class="fa-solid fa-list-check text-emerald-600"></i> Syllabus Checklist
                    </h2>
                    <p class="text-sm text-slate-500 dark:text-slate-400">Tick items as you complete them.</p>
                </div>
                <div class="flex gap-2">
                    <select id="checklist-filter" class="bg-slate-50 dark:bg-slate-800 border border-slate-300 dark:border-slate-700 text-slate-900 dark:text-slate-200 text-sm font-semibold rounded-lg focus:ring-blue-500 focus:border-blue-500 block p-2.5">
                        <option value="all">View All Modules</option>
                        <option value="GIT">GIT & Liver</option>
                        <option value="Endocrinology">Endocrinology</option>
                        <option value="Reproductive">Reproductive</option>
                        <option value="Renal">Renal</option>
                        <option value="Head & Neck">Head & Neck</option>
                        <option value="Neurosciences">Neurosciences</option>
                        <option value="General Education">General Education</option>
                    </select>
                </div>
            </div>
            
            <div class="p-0">
                <div id="checklist-container" class="divide-y divide-slate-100 dark:divide-slate-800">
                    <!-- Checklist items injected via JS -->
                </div>
            </div>
        </section>

    </main>

    <!-- Footer -->
    <footer class="bg-slate-900 dark:bg-black text-slate-400 py-10 mt-12 text-center border-t border-slate-800">
        <p class="mb-3 text-lg text-slate-300 italic serif">"The pain of discipline is far less than the pain of regret."</p>
        <p class="text-xs text-slate-600 uppercase tracking-widest">2nd Year MBBS Examination Tracker</p>
    </footer>

    <!-- Logic -->
    <script>
        // --- Setup Logic ---
        let studentProfile = JSON.parse(localStorage.getItem('mbbsStudentProfile')) || null;

        function checkProfile() {
            if (!studentProfile) {
                document.getElementById('setup-modal').classList.remove('hidden');
            } else {
                updateUIWithProfile();
            }
        }

        function saveProfile() {
            const name = document.getElementById('input-name').value;
            const roll = parseInt(document.getElementById('input-roll').value);

            if (name && roll && roll > 0 && roll <= 360) {
                studentProfile = { name, roll };
                localStorage.setItem('mbbsStudentProfile', JSON.stringify(studentProfile));
                document.getElementById('setup-modal').classList.add('hidden');
                updateUIWithProfile();
                updateCountdown(); // Refresh exams with new dates
            } else {
                alert("Please enter a valid name and roll number (1-360).");
            }
        }

        function editProfile() {
            document.getElementById('setup-modal').classList.remove('hidden');
        }

        function updateUIWithProfile() {
            document.getElementById('student-name-display').innerText = `Welcome, ${studentProfile.name}`;
            
            let group = "Unknown";
            if(studentProfile.roll <= 120) group = "Group 1 (Day 1)";
            else if(studentProfile.roll <= 240) group = "Group 2 (Day 2)";
            else group = "Group 3 (Day 3)";
            
            document.getElementById('student-group-display').innerText = `${group} - Roll ${studentProfile.roll}`;
        }

        // --- Data: Exam Dates Logic ---
        function getExamDates() {
            // Default dates
            let ospe1Date = "2026-01-22"; // Day 1 Default
            let ospe2Date = "2026-02-06"; // Day 1 Default

            if (studentProfile) {
                const roll = studentProfile.roll;
                if (roll <= 120) {
                    // Day 1
                    ospe1Date = "2026-01-22";
                    ospe2Date = "2026-02-06";
                } else if (roll <= 240) {
                    // Day 2
                    ospe1Date = "2026-01-23";
                    ospe2Date = "2026-02-07";
                } else {
                    // Day 3
                    ospe1Date = "2026-01-24";
                    ospe2Date = "2026-02-09"; 
                }
            }

            return [
                { name: "Neurosciences", date: "2026-01-13", color: "indigo" },
                { name: "Head & Neck", date: "2026-01-16", color: "blue" },
                { name: "Endocrinology", date: "2026-01-19", color: "purple" },
                { name: "OSPE/VIVA 1", date: ospe1Date, color: "rose" },
                { name: "GIT & Liver", date: "2026-01-27", color: "orange" },
                { name: "Renal", date: "2026-01-29", color: "cyan" },
                { name: "Reproductive", date: "2026-02-02", color: "pink" },
                { name: "OSPE/VIVA 2", date: ospe2Date, color: "rose" },
                { name: "Gen Education", date: "2026-02-11", color: "emerald" }
            ];
        }

        // --- Dark Mode Logic ---
        function toggleDarkMode() {
            const html = document.documentElement;
            const icon = document.getElementById('theme-icon');
            
            if (html.classList.contains('dark')) {
                html.classList.remove('dark');
                localStorage.setItem('theme', 'light');
                icon.classList.remove('fa-sun');
                icon.classList.add('fa-moon');
                updateChartTheme(false);
            } else {
                html.classList.add('dark');
                localStorage.setItem('theme', 'dark');
                icon.classList.remove('fa-moon');
                icon.classList.add('fa-sun');
                updateChartTheme(true);
            }
        }

        function initTheme() {
            const savedTheme = localStorage.getItem('theme');
            const systemDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            const html = document.documentElement;
            const icon = document.getElementById('theme-icon');

            if (savedTheme === 'dark' || (!savedTheme && systemDark)) {
                html.classList.add('dark');
                if(icon) {
                    icon.classList.remove('fa-moon');
                    icon.classList.add('fa-sun');
                }
            } else {
                html.classList.remove('dark');
                 if(icon) {
                    icon.classList.remove('fa-sun');
                    icon.classList.add('fa-moon');
                }
            }
        }
        initTheme();

        // --- Data: Personal Tracker Config ---
        const personalTrackerModules = [
            { id: "Neurosciences", name: "Neurosciences", icon: "fa-brain" },
            { id: "Head & Neck", name: "Head & Neck", icon: "fa-user-tie" },
            { id: "Endocrinology", name: "Endocrinology", icon: "fa-dna" },
            { id: "GIT", name: "GIT & Liver", icon: "fa-utensils" },
            { id: "Renal", name: "Renal", icon: "fa-droplet" },
            { id: "Reproductive", name: "Reproductive", icon: "fa-baby" },
            { id: "General Education", name: "General Education", icon: "fa-book-open" }
        ];

        // --- Data: Full Syllabus ---
        const rawModulesData = [
            {
                id: "git",
                name: "GIT",
                subjects: [
                    {
                        name: "Gross Anatomy",
                        viva: true,
                        topics: ["Abdominal Quadrants & Regions", "Anterior Abdominal Wall (Muscles/Fascia)", "Inguinal Canal (Boundaries/Contents)", "Peritoneum (Reflections, Greater/Lesser Sac)", "Esophagus (Abdominal Part)", "Stomach (Relations, Blood Supply)", "Duodenum & Pancreas", "Abdominal Aorta & Blood Supply", "Small Intestine vs Large Intestine", "Liver (Lobes, Segments)", "Hepatic Portal System", "Gallbladder & Biliary Tract", "Spleen", "Lumbar Vertebrae", "Posterior Abdominal Wall", "Inferior Vena Cava", "Nerves of Abdomen", "Rectum & Anal Canal", "Surface Anatomy of Abdomen"]
                    },
                    {
                        name: "Physiology",
                        viva: true,
                        topics: ["Introduction to the Digestive System", "Smooth Muscle Electrical Activity (BER, Spike Potentials)", "Swallowing (Dysphagia, Achalasia)", "Motor Functions of Stomach", "Gastric Secretions (HCl, Pepsin)", "Pancreatic Secretions", "Functions of Liver", "Bile Secretion (Salts, Pigments)", "Jaundice & LFTs", "Small Intestine Motility", "Digestion of Carbs, Proteins, Fats", "Absorption of Carbs, Proteins, Fats", "Large Intestine Motility & Secretion", "GI Hormones (Gastrin, CCK, Secretin, GIP)", "Vomiting & Defecation", "Diarrhea & Constipation"]
                    },
                    {
                        name: "Biochemistry",
                        viva: true,
                        topics: ["Exocrine Functions of Liver & Pancreas", "Co-enzymes from Vitamins", "Digestion/Absorption of Proteins", "Amino Acid Degradation & Urea Cycle", "Glycolysis", "TCA Cycle (Krebs)", "Gluconeogenesis", "Glycogen Metabolism", "Digestion/Absorption of Carbohydrates", "Pentose Phosphate Pathway (HMP Shunt)", "Regulation of Metabolic Pathways", "Inborn Errors of Amino Acid Metabolism (PKU, MSUD)", "ETC & Oxidative Phosphorylation", "Uncouplers & Inhibitors of ETC"]
                    },
                    {
                        name: "Pathology",
                        viva: true,
                        topics: ["Oral Inflammatory Lesions & Salivary Gland Diseases", "Neoplastic Oral/Salivary Lesions", "Esophagus: Motor Disorders, Varices, Esophagitis, Barrett's", "Esophageal Carcinoma", "Gastritis (Acute/Chronic/H. Pylori)", "Peptic Ulcer Disease", "Intestinal Obstruction", "Diarrheal Diseases", "Pancreatitis (Acute/Chronic)", "Hepatitis (Viral/Autoimmune/Drug-induced)", "Cirrhosis & Portal Hypertension", "Liver Failure & Encephalopathy", "Jaundice & Cholestasis", "Gallbladder Pathology (Cholelithiasis, Cholecystitis)", "Hepatic Tumors (HCC)"]
                    },
                    {
                        name: "Embryology",
                        viva: true,
                        topics: ["Development of Foregut", "Development of Midgut (Rotation)", "Development of Hindgut", "Development of Liver, Gallbladder, Pancreas", "Development of Diaphragm"]
                    },
                    {
                        name: "Histology",
                        viva: true,
                        topics: ["General Plan of GIT", "Esophagus", "Stomach", "Small Intestine (Duodenum, Jejunum, Ileum)", "Large Intestine", "Pancreas", "Liver & Gallbladder", "Rectum & Anal Canal"]
                    },
                    {
                        name: "Pharmacology",
                        viva: false,
                        topics: ["Drugs for Peptic Ulcer (PPIs, H2 Blockers)", "Antiemetics & Prokinetics", "Laxatives & Antidiarrheals", "Drugs for Hepatitis", "Drugs for IBD"]
                    },
                    {
                        name: "Community Medicine",
                        viva: false,
                        topics: ["Nutritional Problems of Public Health", "Food Safety & Fortification", "Diarrheal Diseases Control", "Hepatitis Prevention", "Dynamics of Disease Transmission"]
                    },
                    {
                        name: "Medicine",
                        viva: false,
                        topics: ["Fatty Liver Disease", "Liver Function Tests Interpretation"]
                    },
                    {
                        name: "Behavioral Sciences",
                        viva: false,
                        topics: ["Theories of Motivation", "Self-Actualization", "Learning About the Self"]
                    },
                    {
                        name: "Radiology",
                        viva: false,
                        topics: ["X-ray/Barium Studies of Gut", "CT Scan Evaluation of Gut", "Ultrasound of Gut"]
                    }
                ]
            },
            {
                id: "endo",
                name: "Endocrinology",
                subjects: [
                    {
                        name: "Physiology",
                        viva: false,
                        topics: ["Classification & Mechanism of Hormones", "Hypothalamic Hormones", "Anterior Pituitary Hormones (GH, Prolactin, etc.)", "Posterior Pituitary (ADH, Oxytocin)", "Thyroid Hormones (T3, T4)", "Parathyroid Hormone & Calcitonin", "Calcium Homeostasis & Vitamin D", "Insulin, Glucagon, Diabetes Mellitus", "Adrenal Cortex (Cortisol, Aldosterone, Androgens)", "Adrenal Medulla", "Pineal Gland", "Thymus & Local Hormones"]
                    },
                    {
                        name: "Biochemistry",
                        viva: true,
                        topics: ["Chemistry of Hormones", "Signal Transduction (cAMP, IP3, etc.)", "Thyroid Synthesis", "Insulin Synthesis & Metabolic Effects", "Cholesterol & Steroid Metabolism", "Adrenal Hormone Metabolism", "Diabetes Mellitus Biochemistry", "Hormonal Regulation of Glucose", "Adrenal Medullary Hormone Metabolism"]
                    },
                    {
                        name: "Gross Anatomy",
                        viva: false, 
                        topics: ["Hypothalamus", "Pituitary Gland", "Thyroid & Parathyroid", "Pancreas (Gross)", "Adrenal Glands"]
                    },
                    {
                        name: "Histology",
                        viva: true,
                        topics: ["Pituitary Gland", "Thyroid & Parathyroid", "Pancreas (Islets)", "Adrenal Gland (Cortex/Medulla)", "Pineal Gland"]
                    },
                    {
                        name: "Embryology",
                        viva: false,
                        topics: ["Development of Pituitary", "Development of Thyroid/Parathyroid", "Development of Pancreas", "Development of Adrenal Gland"]
                    },
                    {
                        name: "Pathology",
                        viva: false,
                        topics: ["Pituitary Adenomas & Hypopituitarism", "Hyper/Hypothyroidism (Graves, Hashimoto)", "Thyroid Neoplasms", "Hyper/Hypoparathyroidism", "Diabetes Pathogenesis & Complications", "Cushing's Syndrome", "Hyperaldosteronism", "Adrenal Insufficiency (Addison's)", "Pheochromocytoma"]
                    },
                    {
                        name: "Pharmacology",
                        viva: false,
                        topics: ["Pituitary Drugs", "Thyroid & Antithyroid Drugs", "Drugs for Parathyroid/Calcium", "Insulin Preparations", "Oral Hypoglycemics", "Corticosteroids"]
                    },
                    {
                        name: "Community Medicine",
                        viva: false,
                        topics: ["Non-communicable Diseases Action Plan", "Obesity Prevention", "Diabetes Epidemiology & Control", "Iodine Control Program", "Cancer Epidemiology", "Metabolic Syndrome in South Asia"]
                    },
                    {
                        name: "Medicine",
                        viva: false,
                        topics: ["Clinical Disorders of Pituitary", "Metabolic Syndrome", "Interpretation of Adrenal Disorders"]
                    },
                    {
                        name: "Behavioral Sciences",
                        viva: false,
                        topics: ["Memory & Related Disorders", "Perception & Related Disorders", "Metacognition", "Empowerment"]
                    }
                ]
            },
            {
                id: "repro",
                name: "Reproductive",
                subjects: [
                    {
                        name: "Physiology",
                        viva: true,
                        topics: ["Spermatogenesis & Semen", "Testosterone Functions", "Oogenesis & Gonads", "Female Hormones (Estrogen/Progesterone)", "Menstrual Cycle", "Puberty & Menopause", "Pregnancy/Fertilization/Implantation", "Placental Hormones", "Parturition & Lactation", "Fetal/Neonatal Physiology", "Contraception", "Infertility"]
                    },
                    {
                        name: "Pathology",
                        viva: false,
                        topics: ["Male Congenital Anomalies", "Testicular Tumors", "Prostatitis & BPH", "Vulva/Vagina/Cervix Lesions", "PCOS & Ovarian Cysts", "Female Congenital Anomalies & PID", "Early/Late Pregnancy Disorders", "Gestational Trophoblastic Disease", "STD Males & Females", "DUB & Endometrial Hyperplasia", "Breast Disorders"]
                    },
                    {
                        name: "Gross Anatomy",
                        viva: true,
                        topics: ["Bony Pelvis (Inlet/Outlet)", "Pelvic Walls/Floor", "Male Internal Organs (Testis, Epididymis, Vas)", "Prostate/Seminal Vesicles", "Male External (Penis, Scrotum)", "Female Genital Tract (Ovary, Tubes, Uterus)", "Female External Genitalia", "Internal Iliac Artery & Veins", "Nerves of Pelvis (Sacral Plexus)", "Perineum & Perineal Spaces", "Ischiorectal Fossa"]
                    },
                    {
                        name: "Histology",
                        viva: true,
                        topics: ["Testis & Duct System", "Prostate/Seminal Vesicles", "Ovary & Fallopian Tube", "Uterus, Cervix, Vagina"]
                    },
                    {
                        name: "Embryology",
                        viva: true,
                        topics: ["Development of the Male Reproductive System", "Development of the Female Reproductive System", "Development of External Genitalia", "Congenital Anomalies", "Structure of Placenta"]
                    },
                    {
                        name: "Biochemistry",
                        viva: true,
                        topics: ["DNA/RNA Structure & Function", "DNA Replication & Repair", "Transcription", "Post-Transcriptional Mods", "Translation & Protein Synthesis", "Regulation of Gene Expression", "Gene Defects", "Male Sex Hormones Bioch", "Estrogen/Progesterone Bioch", "Prolactin Bioch"]
                    },
                    {
                        name: "Pharmacology",
                        viva: false,
                        topics: ["Androgens & Antiandrogens", "Estrogens & Antiestrogens", "Progestins", "Hormonal Contraceptives", "Uterine Motility Drugs"]
                    },
                    {
                        name: "Community Medicine",
                        viva: false,
                        topics: ["Reproductive Health Intro", "Family Planning", "Maternal Care", "Infant Care", "Adolescent Health"]
                    },
                    {
                        name: "Behavioral Sciences",
                        viva: false,
                        topics: ["Gender Based Violence", "Cognitive Behavioral Therapy (CBT)"]
                    },
                    {
                        name: "Radiology",
                        viva: false,
                        topics: ["Radiological Anatomy of Repro System"]
                    },
                    {
                        name: "Skills",
                        viva: false,
                        topics: ["Examination of Prostate"]
                    }
                ]
            },
            {
                id: "hn",
                name: "Head & Neck",
                subjects: [
                    {
                        name: "Gross Anatomy",
                        viva: true,
                        topics: ["Skull (Vault, Normas, Sutures, Fontanelles)", "Scalp (Layers, Innervation, Blood Supply)", "Face (Muscles, Nerve Supply, Blood Supply, Venous Drainage)", "Cranial Nerves (Extracranial Course of V & VII)", "Parotid Region & Gland", "Temporal & Infratemporal Fossae (Muscles of Mastication, Mandibular Nerve, Maxillary Artery)", "Temporomandibular Joint (TMJ) & Mandible", "Submandibular Region & Gland", "Triangles of Neck (Anterior & Posterior)", "Deep Cervical Fascia", "Thyroid & Parathyroid Glands (Gross)", "Oral Cavity (Lips, Cheeks, Floor of Mouth)", "Tongue (Muscles, Innervation, Blood Supply, Lymphatics)", "Palate (Hard & Soft, Muscles)", "Pharynx (Muscles, Parts, Nerve Supply)", "Larynx (Cartilages, Muscles, Innervation)", "Nasal Cavity & Paranasal Sinuses", "Ear (External, Middle, Internal - Gross)", "Orbit (Bones, Extraocular Muscles, Nerves, Vessels)", "Eyelids & Lacrimal Apparatus", "Blood Vessels of Head & Neck (Carotid System, Jugular Veins)", "Lymphatic Drainage of Head & Neck"]
                    },
                    {
                        name: "Physiology",
                        viva: true,
                        topics: ["Optics of Vision (Refraction, Accommodation, Errors)", "Visual Acuity & Field of Vision", "Phototransduction (Rods & Cones)", "Dark & Light Adaptation", "Color Vision", "Visual Pathway & Lesions", "Pupillary Light Reflex", "Eye Movements & Control", "Aqueous Humor (Formation, Circulation, IOP)", "Hearing Mechanism (Middle Ear Impedance Matching, Cochlear Function)", "Auditory Pathway", "Vestibular System (Equilibrium & Balance)", "Olfaction (Receptors & Pathway)", "Gustation (Receptors & Pathway)"]
                    },
                    {
                        name: "Histology",
                        viva: true,
                        topics: ["Eye (Cornea, Retina, Lens, Ciliary Body, Iris)", "Eyelid & Lacrimal Gland", "Ear (Organ of Corti, Cochlea)", "Oral Cavity (Lip, Cheek, Gingiva, Palate)", "Tongue (Papillae, Taste Buds)", "Salivary Glands (Parotid, Submandibular, Sublingual)", "Nasal Cavity (Respiratory & Olfactory Epithelium)", "Thyroid & Parathyroid Glands"]
                    },
                    {
                        name: "Embryology",
                        viva: true,
                        topics: ["Pharyngeal Apparatus (Arches, Pouches, Clefts)", "Development of Face, Nose & Palate", "Development of Tongue & Thyroid Gland", "Development of the Eye", "Development of the Ear", "Congenital Anomalies (Cleft Lip/Palate, Thyroglossal Cyst, Branchial Cyst)"]
                    },
                    {
                        name: "Biochemistry",
                        viva: false,
                        topics: ["Vitamin A (Chemistry, Sources, Absorption, Transport)", "Visual Cycle (Wald's Visual Cycle)", "Role of Retinaldehyde in Vision", "Vitamin A Deficiency Disorders"]
                    },
                    {
                        name: "Pathology",
                        viva: false,
                        topics: ["Neoplastic Lesions of Head & Neck (Oral Cavity, Larynx, Salivary Glands)"]
                    },
                    {
                        name: "Community Medicine",
                        viva: false,
                        topics: ["Nuclear Medicine", "School Health Services", "Travel Medicine"]
                    }
                ]
            },
            {
                id: "neuro",
                name: "Neurosciences",
                subjects: [
                    {
                        name: "Gross Anatomy",
                        viva: true,
                        topics: ["Skull & Cranial Fossae", "Meninges", "Spinal Cord (Gross, Tracts)", "Brainstem (Medulla, Pons, Midbrain)", "Cranial Nerve Nuclei", "Cerebellum (Gross)", "Diencephalon (Thalamus/Hypothalamus)", "Cerebral Cortex (Functional Areas)", "Basal Nuclei", "Internal Capsule", "Blood Supply (Circle of Willis)", "Ventricles & CSF", "Limbic System"]
                    },
                    {
                        name: "Physiology",
                        viva: true,
                        topics: ["Neuron Potentials", "Synapse", "Sensory Pathways (DCML, AL)", "Motor Pathways (Corticospinal)", "Reflexes", "Cerebellum Functions", "Basal Ganglia Functions", "Hypothalamus/Thalamus", "Sleep/EEG", "ANS", "Pain Pathway"]
                    },
                    {
                        name: "Biochemistry",
                        viva: true,
                        topics: ["Neurotransmitters", "Neurotropic Vitamins (B1, B6, B12)", "Blood Brain Barrier", "Brain Metabolism", "Dopamine & Parkinsonism", "Serotonin & Pain", "Neurolipids"]
                    },
                    {
                        name: "Pathology",
                        viva: false,
                        topics: ["Cellular Pathology of CNS", "Cerebral Edema/Herniation", "Traumatic Injury", "Cerebrovascular Disease (Stroke)", "CNS Infections (Meningitis)", "Prion Disease", "Neuromuscular Junction Disorders"]
                    },
                    {
                        name: "Embryology",
                        viva: true,
                        topics: ["Development of the Nervous System", "Development of the Brain", "Developmental Anomalies"]
                    },
                    {
                        name: "Histology",
                        viva: true,
                        topics: ["Nervous Tissue", "Cerebellar Cortex", "Cerebral Cortex"]
                    },
                    {
                        name: "Pharmacology",
                        viva: false,
                        topics: ["Neurotransmitter Pharmacology", "Opioid Analgesics", "Anticoagulants"]
                    },
                    {
                        name: "Community Medicine",
                        viva: false,
                        topics: ["Endemic Diseases (Diphtheria, Tetanus)", "Stroke Prevention", "Snake Bite", "Polio", "Rabies", "Mental Health", "Drug Abuse"]
                    },
                    {
                        name: "Behavioral Sciences",
                        viva: false,
                        topics: ["Medical Ethics", "Emotional Intelligence", "Conflict Resolution", "Crisis Intervention"]
                    }
                ]
            },
            {
                id: "renal",
                name: "Renal",
                subjects: [
                    {
                        name: "Gross Anatomy",
                        viva: true,
                        topics: ["Kidney (Gross Features, Relations, Neurovasculature)", "Ureter (Course, Constrictions, Relations)", "Urinary Bladder (Parts, Relations, Blood Supply)", "Urethra (Male vs Female Structure)", "Surface Anatomy of Urinary System", "Pelvic Floor & Perineum Relevance"]
                    },
                    {
                        name: "Histology",
                        viva: true,
                        topics: ["Microscopic Structure of Nephron (PCT, DCT, Loop)", "Histology of Collecting Ducts", "Juxtaglomerular Apparatus (JGA) Histology", "Histology of Ureter, Bladder & Urethra (Transitional Epithelium)"]
                    },
                    {
                        name: "Embryology",
                        viva: true,
                        topics: ["Development of Kidney (Pronephros, Mesonephros, Metanephros)", "Development of Ureter & Collecting System", "Development of Urinary Bladder & Urethra", "Congenital Anomalies (Horseshoe Kidney, Polycystic Kidney, etc.)"]
                    },
                    {
                        name: "Physiology",
                        viva: true,
                        topics: ["Body Fluid Compartments & Regulation", "Glomerular Filtration Rate (GFR) & Autoregulation", "Tubular Reabsorption & Secretion (PCT, Loop, DCT, CD)", "Counter-Current Mechanism (Urine Concentration)", "Renal Clearance Concepts", "Acid-Base Balance & Renal Regulation of pH", "Electrolyte Balance (Na+, K+, Ca++, Mg++, Phosphate)", "Renin-Angiotensin-Aldosterone System (RAAS)", "Micturition Reflex & Neural Control"]
                    },
                    {
                        name: "Biochemistry",
                        viva: true,
                        topics: ["Renal Function Tests", "Acid-Base Buffers and Disorders", "Purine Metabolism", "Uric Acid/Gout", "Urine Analysis", "Creatinine Metabolism & Clearance Estimation"]
                    },
                    {
                        name: "Pathology",
                        viva: false,
                        topics: ["Glomerular Diseases (Nephritic vs Nephrotic Syndrome)", "Acute & Chronic Glomerulonephritis", "Acute Tubular Necrosis (ATN) & Tubulointerstitial Diseases", "Pyelonephritis & Urinary Tract Infections (UTI)", "Urolithiasis (Renal Stones Types & Pathogenesis)", "Obstructive Uropathy & Hydronephrosis", "Renal Tumors (Wilms Tumor, RCC)", "Urinary Bladder Tumors", "Renal Failure (Acute & Chronic)"]
                    },
                    {
                        name: "Pharmacology",
                        viva: false,
                        topics: ["Loop Diuretics (Furosemide)", "Thiazide Diuretics", "Potassium-Sparing Diuretics", "Carbonic Anhydrase Inhibitors & Osmotic Diuretics", "Clinical Uses & Side Effects of Diuretics"]
                    }
                ]
            },
            {
                id: "gened",
                name: "General Education",
                isGenEd: true,
                subjects: [
                    {
                        name: "Expository Writing",
                        viva: false,
                        topics: ["Structure of Scientific Paper (IMRAD)", "Writing Process (Drafting, Editing)", "Essay Organization (Cohesion/Coherence)", "Academic Audience & Conventions", "Plagiarism & Types", "Citation & Referencing (Vancouver)", "Summarizing & Paraphrasing"]
                    },
                    {
                        name: "Islamic Studies",
                        viva: false,
                        topics: ["Articles of Faith", "Five Pillars of Islam", "Tawheed & Healing", "Prophet Muhammad (PBUH) as Role Model", "Makki Life & Seeking Knowledge", "Madina Life & Adaptability"]
                    },
                    {
                        name: "Moral Ethics",
                        viva: false,
                        topics: ["Descriptive, Normative & Meta Ethics", "Virtue Ethics (Plato/Aristotle)", "Utilitarianism vs Deontology (Kant)", "Human & Animal Rights", "Theories of Justice", "Bioethics & Medical Ethics"]
                    },
                    {
                        name: "Ideology & Constitution",
                        viva: false,
                        topics: ["Two-Nation Theory", "Ideology of Pakistan", "Constitution Structure", "18th Amendment (Provincial Autonomy)", "Fundamental Rights"]
                    },
                    {
                        name: "ICT Application",
                        viva: false,
                        topics: ["MS Word & Excel for Medical Docs", "Digital Infrastructure", "Freelancing & Digital Markets", "Intellectual Property Rights", "Python Basics (Lists, Dictionaries)", "Cybersecurity & Ethics"]
                    },
                    {
                        name: "Entrepreneurship",
                        viva: false,
                        topics: ["Opportunity Recognition in Healthcare", "Business Model Canvas (BMC)", "Marketing 4Ps in Health", "Legal Structures & Funding"]
                    },
                    {
                        name: "Civics & Community",
                        viva: false,
                        topics: ["Citizenship Rights & Duties", "Community Engagement Principles", "State & Civil Society", "Diversity & Social Justice"]
                    }
                ]
            }
        ];

        // --- Logic: Personal Tracker (Cards) ---
        function renderPersonalTracker() {
            const container = document.getElementById('personal-tracker-grid');
            const savedState = JSON.parse(localStorage.getItem('mbbsChecklist')) || {};
            
            const progressData = {};
            personalTrackerModules.forEach(m => { progressData[m.name] = { total: 0, done: 0 }; });

            const checklistData = [];
            rawModulesData.forEach(mod => {
                // Removed the filter that skipped Gen Ed
                // if (mod.isGenEd) return; 

                mod.subjects.forEach(sub => {
                    sub.topics.forEach(topic => {
                        checklistData.push({
                            module: mod.name,
                            subject: sub.name,
                            task: topic,
                            isViva: sub.viva
                        });
                    });
                });
            });

            checklistData.forEach(item => {
                let key = item.module;
                if (key === "GIT") key = "GIT & Liver";
                
                if (progressData[key]) {
                    progressData[key].total++;
                    const uniqueId = item.task.replace(/[^a-zA-Z0-9]/g, '');
                    if (savedState[uniqueId]) progressData[key].done++;
                }
            });

            container.innerHTML = personalTrackerModules.map(mod => {
                // Removed the filter that hid General Education
                
                const stats = progressData[mod.name] || { total: 1, done: 0 };
                const percent = Math.round((stats.done / stats.total) * 100) || 0;
                
                return `
                <div class="personal-tracker-card bg-white dark:bg-slate-900 rounded-lg p-4 border border-slate-100 dark:border-slate-800 flex flex-col items-center text-center cursor-pointer transition-colors" onclick="filterByModule('${mod.id}')">
                    <div class="w-10 h-10 rounded-full bg-indigo-50 dark:bg-indigo-900/30 flex items-center justify-center mb-3 text-indigo-600 dark:text-indigo-400">
                        <i class="fa-solid ${mod.icon}"></i>
                    </div>
                    <h3 class="font-bold text-sm text-slate-800 dark:text-slate-200 mb-1 whitespace-nowrap overflow-hidden text-ellipsis w-full" title="${mod.name}">${mod.name}</h3>
                    <div class="w-full bg-slate-100 dark:bg-slate-700 rounded-full h-1.5 mb-2">
                        <div class="bg-emerald-500 h-1.5 rounded-full transition-all duration-500" style="width: ${percent}%"></div>
                    </div>
                    <p class="text-xs text-slate-500 dark:text-slate-400 font-semibold">${percent}% Complete</p>
                </div>
                `;
            }).join('');
        }

        // --- Logic: Checklist & Persistence ---
        function initChecklist() {
            const container = document.getElementById('checklist-container');
            const filter = document.getElementById('checklist-filter');
            
            const savedState = JSON.parse(localStorage.getItem('mbbsChecklist')) || {};

            function render(filterValue) {
                container.innerHTML = '';
                
                // Flatten data for rendering
                const checklistData = [];
                rawModulesData.forEach(mod => {
                    const sortedSubjects = mod.subjects.sort((a, b) => {
                        if (mod.id === 'endo') {
                            const endoPriority = { "Histology": 1, "Biochemistry": 2 };
                            const pA = endoPriority[a.name] || 99;
                            const pB = endoPriority[b.name] || 99;
                            if (pA !== pB) return pA - pB;
                            return 0;
                        }
                        const anatOrder = { "Anatomy": 1, "Gross Anatomy": 1, "Neuroanatomy": 1, "Histology": 2, "Embryology": 3 };
                        const orderA = anatOrder[a.name] || 4;
                        const orderB = anatOrder[b.name] || 4;
                        return orderA - orderB;
                    });

                    sortedSubjects.forEach(sub => {
                        sub.topics.forEach(topic => {
                            checklistData.push({
                                module: mod.name,
                                subject: sub.name,
                                task: topic,
                                isViva: sub.viva
                            });
                        });
                    });
                });

                const filteredData = filterValue === 'all' ? checklistData : checklistData.filter(i => {
                    if(filterValue === "GIT" && i.module === "GIT") return true;
                    if(filterValue === "Renal" && i.module === "Renal") return true;
                    if(filterValue === "Neurosciences" && i.module === "Neurosciences") return true;
                    if(filterValue === "Head & Neck" && i.module === "Head & Neck") return true;
                    if(filterValue === "Endocrinology" && i.module === "Endocrinology") return true;
                    if(filterValue === "Reproductive" && i.module === "Reproductive") return true;
                    if(filterValue === "General Education" && i.module === "General Education") return true;
                    return false;
                });
                
                if (filteredData.length === 0) {
                    container.innerHTML = '<div class="p-8 text-center text-slate-400 dark:text-slate-500">No items found.</div>';
                    return;
                }

                let currentMod = '';

                filteredData.forEach((item, idx) => {
                    const uniqueId = item.task.replace(/[^a-zA-Z0-9]/g, '');
                    const isChecked = savedState[uniqueId] || false;

                    if (filterValue === 'all' && item.module !== currentMod) {
                        currentMod = item.module;
                        let displayModName = currentMod;
                        if(currentMod === "GIT") displayModName = "GIT & Liver";
                        
                        const headerColor = currentMod === "General Education" ? "bg-emerald-50 dark:bg-emerald-900/20 text-emerald-600 dark:text-emerald-400" : "bg-slate-50 dark:bg-slate-800 text-slate-500 dark:text-slate-400";
                        
                        container.innerHTML += `<div class="${headerColor} px-6 py-2 text-xs font-bold uppercase tracking-wider sticky top-0 border-t border-b border-slate-200 dark:border-slate-700 mt-2 z-10">${displayModName}</div>`;
                    }

                    const div = document.createElement('div');
                    div.className = `checklist-item px-6 py-4 flex items-start gap-4 transition-all hover:bg-slate-50 dark:hover:bg-slate-800/50 ${isChecked ? 'checked' : 'text-slate-800 dark:text-slate-300'}`;
                    
                    div.innerHTML = `
                        <div class="pt-1">
                            <div class="check-circle w-5 h-5 border-2 border-slate-300 dark:border-slate-600 rounded-full flex items-center justify-center transition-colors cursor-pointer ${isChecked ? 'bg-emerald-500 border-emerald-500' : ''}" onclick="toggleCheck('${uniqueId}', this)">
                                ${isChecked ? '<i class="fa-solid fa-check text-white text-xs"></i>' : ''}
                            </div>
                        </div>
                        <div class="flex-1">
                            <p class="text-sm font-medium leading-snug transition-colors">${item.task}</p>
                            <div class="flex items-center gap-2 mt-1">
                                <span class="text-xs inline-block px-2 py-0.5 rounded-full bg-slate-100 dark:bg-slate-800 text-slate-500 dark:text-slate-400 border border-slate-200 dark:border-slate-700">${item.subject}</span>
                                ${item.isViva ? '<span class="viva-badge text-[10px] font-bold text-white bg-rose-500 px-2 py-0.5 rounded-full shadow-sm shadow-rose-500/30">VIVA IMPORTANT</span>' : ''}
                            </div>
                        </div>
                    `;
                    container.appendChild(div);
                });
            }

            window.toggleCheck = (id, circle) => {
                savedState[id] = !savedState[id];
                localStorage.setItem('mbbsChecklist', JSON.stringify(savedState));
                updateProgress();
                
                const parent = circle.closest('.checklist-item');
                
                if (savedState[id]) {
                    parent.classList.add('checked');
                    parent.classList.remove('text-slate-800', 'dark:text-slate-300'); 
                    
                    circle.classList.add('bg-emerald-500', 'border-emerald-500');
                    circle.innerHTML = '<i class="fa-solid fa-check text-white text-xs"></i>';
                } else {
                    parent.classList.remove('checked');
                    parent.classList.add('text-slate-800', 'dark:text-slate-300');
                    
                    circle.classList.remove('bg-emerald-500', 'border-emerald-500');
                    circle.innerHTML = '';
                }
            };

            filter.addEventListener('change', (e) => render(e.target.value));
            render('all');
            updateProgress();
        }

        function filterByModule(moduleName) {
            const select = document.getElementById('checklist-filter');
            select.value = moduleName;
            const event = new Event('change');
            select.dispatchEvent(event);
            document.getElementById('checklist-section').scrollIntoView({behavior: 'smooth'});
        }

        function resetPersonalTracker() {
            if(confirm("Reset all progress? This cannot be undone.")) {
                localStorage.removeItem('mbbsChecklist');
                localStorage.removeItem('mbbsStudentProfile');
                location.reload();
            }
        }

        function updateProgress() {
            const savedState = JSON.parse(localStorage.getItem('mbbsChecklist')) || {};
            const checklistData = [];
            rawModulesData.forEach(mod => {
                if (mod.isGenEd) return; 

                mod.subjects.forEach(sub => {
                    sub.topics.forEach(topic => {
                        checklistData.push(topic);
                    });
                });
            });
            const total = checklistData.length;
            let validCompleted = 0;
            checklistData.forEach(item => {
                const uniqueId = item.replace(/[^a-zA-Z0-9]/g, '');
                if (savedState[uniqueId]) validCompleted++;
            });

            const percent = total === 0 ? 0 : Math.round((validCompleted / total) * 100);
            document.getElementById('global-progress').innerText = `${percent}%`;

            if (prepChart) {
                prepChart.data.datasets[0].data = [percent, 100 - percent];
                prepChart.update();
            }

            renderPersonalTracker();
        }

        // --- Logic: Countdown & Prep Chart ---
        let prepChart = null;
        function updateCountdown() {
            const today = new Date();
            const examGrid = document.getElementById('exam-grid');
            
            // Get dates dynamically based on roll number
            const examData = getExamDates();
            
            examGrid.innerHTML = examData.map(ex => {
                const examDate = new Date(ex.date);
                const diff = Math.ceil((examDate - today) / (1000 * 60 * 60 * 24));
                const days = diff > 0 ? diff : "DONE";
                
                const colorMap = {
                    indigo: 'bg-indigo-50 dark:bg-indigo-900/20 text-indigo-600 dark:text-indigo-400 border-indigo-100 dark:border-indigo-800',
                    blue: 'bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400 border-blue-100 dark:border-blue-800',
                    purple: 'bg-purple-50 dark:bg-purple-900/20 text-purple-600 dark:text-purple-400 border-purple-100 dark:border-purple-800',
                    rose: 'bg-rose-50 dark:bg-rose-900/20 text-rose-600 dark:text-rose-400 border-rose-100 dark:border-rose-800',
                    orange: 'bg-orange-50 dark:bg-orange-900/20 text-orange-600 dark:text-orange-400 border-orange-100 dark:border-orange-800',
                    cyan: 'bg-cyan-50 dark:bg-cyan-900/20 text-cyan-600 dark:text-cyan-400 border-cyan-100 dark:border-cyan-800',
                    pink: 'bg-pink-50 dark:bg-pink-900/20 text-pink-600 dark:text-pink-400 border-pink-100 dark:border-pink-800',
                    emerald: 'bg-emerald-50 dark:bg-emerald-900/20 text-emerald-600 dark:text-emerald-400 border-emerald-100 dark:border-emerald-800',
                };
                
                let classes = `rounded-lg p-3 border transition-all ${colorMap[ex.color]} flex flex-col justify-center min-h-[90px]`;
                if(diff < 0) classes += " opacity-50 grayscale";
                
                return `
                <div class="${classes}">
                    <p class="text-[10px] font-bold uppercase tracking-wide w-full overflow-hidden text-ellipsis whitespace-nowrap" title="${ex.name}">${ex.name}</p>
                    <p class="text-2xl font-black my-1">${days}</p>
                    <p class="text-[10px] font-medium opacity-80">${diff <= 0 ? (diff === 0 ? "TODAY" : "Passed") : "Days Left"}</p>
                </div>
                `;
            }).join('');
        }

        function updateChartTheme(isDark) {
            if(!prepChart) return;
            const remainingColor = isDark ? '#334155' : '#e2e8f0'; 
            prepChart.data.datasets[0].backgroundColor = ['#10b981', remainingColor];
            prepChart.update();
        }

        function renderCharts() {
            const ctx = document.getElementById('prepChart').getContext('2d');
            const isDark = document.documentElement.classList.contains('dark');
            const remainingColor = isDark ? '#334155' : '#e2e8f0';

            prepChart = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: ['Completed', 'Remaining'],
                    datasets: [{
                        data: [0, 100],
                        backgroundColor: ['#10b981', remainingColor],
                        borderWidth: 0,
                        hoverOffset: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { 
                            position: 'bottom',
                            labels: {
                                color: isDark ? '#e2e8f0' : '#1e293b' 
                            }
                        },
                        tooltip: { callbacks: { label: function(context) { return context.label + ': ' + context.raw + '%'; } } }
                    }
                }
            });
        }

        window.addEventListener('DOMContentLoaded', () => {
            checkProfile();
            updateCountdown();
            renderCharts();
            initChecklist();
        });

    </script>
</body>

</html>



